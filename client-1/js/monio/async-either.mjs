/*! Monio: async-either.mjs
    v0.34.0-pre (c) 2022 Kyle Simpson
    MIT License: http://getify.mit-license.org
*/
import{isFunction,isPromise}from"./lib/util.mjs";import Either from"./either.mjs";const BRAND={};export default Object.assign(AsyncEither,{Left:AsyncLeft,Right:AsyncRight,of:AsyncRight,pure:AsyncRight,unit:AsyncRight,is:is,fromFoldable:fromFoldable,fromPromise:fromPromise});function AsyncLeft(i){return AsyncEither(Either.Left(i))}function AsyncRight(i){return AsyncEither(Either.Right(i))}function AsyncEither(i){return fromPromise(isPromise(i)?i:Either.Left.is(i)?Promise.reject(i):Promise.resolve(i))}function fromPromise(i){i=splitPromise(i);var r={map:function map(r){var handle=i=>{var _doMap=r=>{var t=i.chain(r);return isPromise(t)?splitPromise(t):i._is_right()?t:Promise.reject(t)};return isPromise(r)?r.then(_doMap):_doMap(r)};return AsyncEither(i.then(handle,handle))},chain:chain,flatMap:chain,bind:chain,ap:function ap(r){return r.map(i)},concat:function concat(r){return r.map((r=>i.then((i=>i.concat(r)))))},fold:function fold(r,t){var handle=i=>r=>r.fold((r=>Promise.reject(i(r))),i),e=i.then(handle(t),handle(r));return e.catch((()=>{})),e},_inspect:function _inspect(){return`${r[Symbol.toStringTag]}(Promise)`},_is:function _is(i){return i===BRAND},[Symbol.toStringTag]:"AsyncEither"};return r;function chain(r){var handle=i=>{var _doChain=r=>{var t=i.chain(r);return is(t)?t.fold((i=>i),(i=>i)):Either.is(t)?t.fold((i=>Promise.reject(i)),(i=>i)):t};return isPromise(r)?r.then(_doChain):_doChain(r)};return AsyncEither(i.then(handle,handle))}}function is(i){return!!(i&&isFunction(i._is)&&i._is(BRAND))}function fromFoldable(i){return i.fold(AsyncEither.Left,AsyncEither.Right)}function splitPromise(i){var r=i.then((i=>Either.is(i)?i:Either.Right(i)),(i=>Promise.reject(Either.is(i)?i:Either.Left(i))));return r.catch((()=>{})),r}